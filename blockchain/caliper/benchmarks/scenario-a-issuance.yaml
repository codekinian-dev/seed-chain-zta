test:
  name: scenario-a-issuance
  description: Scenario A - Certificate Issuance (Write-Heavy). Gradual Ramp-up.
  workers:
    number: 5 
  rounds:
    # --- TAHAP 1: Pemanasan (Safe Zone) ---
    - label: issuance-50tps
      txDuration: 60
      rateControl: { type: fixed-rate, opts: { tps: 50 } }
      workload:
        module: ./workload/createSeedBatch-50.js
        arguments: { contractId: benih-certification }

    # --- TAHAP 2: Beban Menengah (Optimal) ---
    - label: issuance-100tps
      txDuration: 60
      rateControl: { type: fixed-rate, opts: { tps: 100 } }
      workload:
        module: ./workload/createSeedBatch-100.js
        arguments: { contractId: benih-certification }

    # --- TAHAP 3: Mencari Batas (Approaching Limit) ---
    # Ini sangat penting untuk melihat kapan latency mulai naik
    - label: issuance-150tps
      txDuration: 60
      rateControl: { type: fixed-rate, opts: { tps: 150 } }
      workload:
        module: ./workload/createSeedBatch-150.js
        arguments: { contractId: benih-certification }

    # --- TAHAP 4: Titik Jenuh (Saturation Point) ---
    # Kemungkinan besar latency akan melonjak di sini (sesuai data Anda ~190 TPS)
    - label: issuance-200tps
      txDuration: 60
      rateControl: { type: fixed-rate, opts: { tps: 200 } }
      workload:
        module: ./workload/createSeedBatch-200.js
        arguments: { contractId: benih-certification }

    # --- TAHAP 5: Stress Test Ringan ---
    # Jika 200 TPS masih aman, baru coba ini.
    # Jangan langsung ke 500/1000!
    - label: issuance-250tps
      txDuration: 60
      rateControl: { type: fixed-rate, opts: { tps: 250 } }
      workload:
        module: ./workload/createSeedBatch-250.js
        arguments: { contractId: benih-certification }

monitors:
  resource:
  - module: prometheus
    options:
      url: "http://localhost:9090"
      metrics:
        include: [peer*, orderer*, couch*]
        queries:
        - name: Avg Memory (MB)
          query: 'sum(container_memory_usage_bytes{name=~".+"}) by (name)'
          step: 10
          label: name
          statistic: avg
          multiplier: 0.000001
        - name: Max Memory (MB)
          query: 'sum(container_memory_usage_bytes{name=~".+"}) by (name)'
          step: 10
          label: name
          statistic: max
          multiplier: 0.000001
        - name: Avg CPU (%)
          query: 'sum(rate(container_cpu_usage_seconds_total{name=~".+"}[1m])) by (name) * 100'
          step: 10
          label: name
          statistic: avg
        - name: Max CPU (%)
          query: 'sum(rate(container_cpu_usage_seconds_total{name=~".+"}[1m])) by (name) * 100'
          step: 10
          label: name
          statistic: max